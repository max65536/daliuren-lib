# 大六壬排盘取传流程图（按 reference.md）

本流程图总结了 reference.md 中的判课与取传顺序，便于核对规则实现。建议在支持 Mermaid 的查看器中渲染。

```mermaid
flowchart TD
  A[开始 / 输入] --> B[准备数据\n- 日干支\n- 占时\n- 月将/值将\n- 构成天地盘与四课]
  B --> C{反吟?\n月将与占时相冲}
  C -- 是 --> C1{四课有克?}
  C1 -- 是 --> G[进入常规判课流程\n贼克/比用/涉害/遥克/昂星等]
  C1 -- 否 --> C2[反吟法\n- 初: 驿马\n- 中: 支上\n- 末: 干上\n注: 仅丁/己/辛 未/丑六日]
  C -- 否 --> D{伏吟?\n月将与占时相同}
  D -- 是 --> D1{四课有克?}
  D1 -- 是 --> D2[伏吟有克:\n- 初: 依克取\n- 中: 取初刑\n- 末: 取中刑\n若初传自刑→中取支上]
  D1 -- 否 --> D3[伏吟无克:\n阳日: 初干上→中初刑→末中刑\n阴日: 初支上→中初刑→末中刑]
  D -- 否 --> E{四课不全?\n仅三课}
  E -- 是 --> E1[别责课:\n- 无克无遥克\n- 阳: 初干合上神\n- 阴: 初支前三合\n- 中/末: 干上]
  E -- 否 --> F{八专?\n仅两课（多由干支同位）}
  F -- 是 --> F1[八专课:\n阳: 初干上顺数三位\n阴: 初第四课上神逆数三位\n中/末: 干上]
  F -- 否 --> G

  subgraph 常规判课流程
  direction TB
  G --> H{统计上下贼克}
  H -- 恰有1处 --> I{是否下贼上?}
  I -- 是 --> I1[重审课:\n- 取受克神为初传\n- 中=初上神\n- 末=中上神]
  I -- 否 --> I2[元首课:\n- 取上克下为初传\n- 中/末递推]
  H -- ≥2处 --> J{比用可判别?}
  J -- 是 --> J1[比用课:\n- 取与日干同阴阳者\n- 中/末递推\n注: 二上/二下=知一]
  J -- 否 --> K[涉害课:\n- 优先取孟上神\n- 无孟取仲\n- 中/末递推]
  H -- 0处 --> L{有遥克?}
  L -- 上神克日干 --> L1[蒿矢课:\n取遥克日干神]
  L -- 日干克上神 --> L2[弹射课:\n取被克神]
  L -- 多候选 --> L3[取与日干同阴阳]
  L -- 均无 --> M[昂星课:\n阳: 初酉宫上神→中支上→末干上\n阴: 初酉下神→中干上→末支上]
  end

  %% 结束节点
  I1 --> Z[输出三传]
  I2 --> Z
  J1 --> Z
  K --> Z
  L1 --> Z
  L2 --> Z
  L3 --> Z
  M --> Z
  C2 --> Z
  D2 --> Z
  D3 --> Z
  E1 --> Z
  F1 --> Z
```

## 术语与判定要点

- 克/贼：
  - 上克下：上神五行克制下神五行。
  - 下贼上：下神五行克制上神五行。
- 阴阳“比”：与日干阴阳属性相同为“比”，不同为“不比”。
- 驿马（四组）：申子辰→寅；寅午戌→申；巳酉丑→亥；亥卯未→巳。
- 天干五合：甲己、乙庚、丙辛、丁壬、戊癸（取相合天干之寄宫上神）。
- 地支三合：申子辰、巳酉丑、亥卯未、寅午戌（“前三合”按顺时针上一位）。
- 刑：子卯刑；寅巳申相刑；丑戌未相刑；辰午酉亥自刑。

## 判定顺序概览

1) 先判特殊格局：反吟/伏吟（其下再视“有无克”决定是否走常规或专门规则）。
2) 再判结构缺陷：仅三课→别责；仅两课→八专（多由干支同位产生）。
3) 常规判课：
   - 1处贼克→贼克课（区分重审/元首）。
   - ≥2处贼克→比用；若“俱比或俱不比”无法区分→涉害（孟优先→仲→季）。
   - 无贼克→遥克（蒿矢/弹射，必要时比阴阳）；若无遥克→昂星（阳/阴分流）。

> 注：以上完全依据 reference.md 描述组织。如需细化“上/下神来源”“上神递推”的盘面构造，请在实现阶段进一步补充对应数据结构与取值函数。
